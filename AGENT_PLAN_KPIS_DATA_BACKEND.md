# План: KPI → `/api/data` — Backend

**Цель:** создать view и конфиг `component_queries` для KPI, чтобы `GET /api/data?query_id=kpis` возвращал данные **в точности** как старый `/api/kpis`.
**Статус:** ✅ Завершено  
**Зависимости:** Нет

## Задачи
- [x] Создать view для KPI с фильтрацией:
  - исключить удалённые/неактивные компоненты
  - исключить удалённые связи в `layout_component_mapping`
  - учитывать `layout_id` через join (без hard‑code).
- [x] Добавить запись в `config.component_queries`:
  - `query_id = "kpis"`
  - `config_json` с `:layout_id` и параметрами `:p1/:p2/:p3`
  - структура результата **в точности** как старый `/api/kpis`.
- [x] Убедиться, что `wrapJson` задан корректно (если требуется).
- [x] Проверить вручную: сравнить `/api/kpis` vs `/api/data?query_id=kpis`.

## Файлы для изменения
- `backend/src/migrations/*_create_kpis_view.sql`
- `backend/src/migrations/*_seed_component_queries.sql` (или текущий механизм записи в БД)

## Критерии завершения
- [x] View создан и возвращает KPI по `layout_id`
- [x] Конфиг `kpis` корректно генерирует SQL
- [x] Новый endpoint возвращает структуру идентичную старому
- [x] Базовые проверки разработчика выполнены

## Инструкции
1. Выполни задачи по порядку.
2. Обнови статус этого файла на ✅.
3. НЕ переходи к задачам других агентов.
