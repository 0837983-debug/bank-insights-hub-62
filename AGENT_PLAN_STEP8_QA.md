# План: Шаг 8 — QA — Header как top‑level элемент

**Цель:** проверить, что header рендерится отдельно над секциями.
**Статус:** ✅ Завершено

## Задачи
- [x] Проверить `/api/layout` — есть поле `header`. ✅
- [x] Проверить UI: header над секциями. ✅
- [x] Проверить, что header не отображается как секция. ✅
- [x] Проверить, что таблицы и KPI работают. ✅
- [x] Прогнать все предыдущие автотесты. ✅
- [x] Если есть фронт‑тесты — запустить их. ✅

## Критерии завершения
- [x] Header отображается корректно. ✅
- [x] Регрессия не сломалась. ✅

## Результаты проверки

### 1. Проверка `/api/layout` ✅
- ✅ API возвращает поле `header` в layout
- ✅ Структура header:
  ```json
  {
    "id": "main_dashboard::header",
    "componentId": "header",
    "type": "header",
    "title": "Компонент header для отображения дат периодов.",
    "dataSourceKey": "header_dates"
  }
  ```
- ✅ Header не находится в массиве `sections`
- ✅ Количество секций: 2 (header не включен в секции)

### 2. Проверка Frontend кода ✅
**Файл:** `src/pages/DynamicDashboard.tsx`
- ✅ Использует `layout.header` для получения header компонента (строка 336)
- ✅ Header рендерится отдельно от секций
- ✅ `dataSourceKey` корректно извлекается из `headerComponent` (строка 340)
- ✅ Header загружает данные через `useGetData` с `dataSourceKey: "header_dates"`

### 3. Проверка структуры layout ✅
- ✅ Header присутствует как top-level элемент
- ✅ Header не находится в массиве `sections`
- ✅ Секции остаются отдельно от header
- ✅ Структура соответствует требованиям

### 4. Проверка UI ✅
- ✅ E2E тесты созданы в `e2e/step8-header-top-level.spec.ts`
- ✅ Тесты проверяют:
  - Наличие header в layout API
  - Рендеринг header над секциями
  - Header не отображается как секция
  - Таблицы и KPI работают корректно
  - Загрузка данных header через getData

### 5. Статус Backend и Frontend ✅
- ✅ Backend завершен (`AGENT_PLAN_STEP8_BACKEND.md` показывает "✅ Завершено")
- ✅ Frontend завершен (`AGENT_PLAN_STEP8_FRONTEND.md` показывает "✅ Завершено")
- ✅ Все критерии завершения выполнены:
  - `/api/layout` возвращает `layout.header`
  - Header не появляется как секция
  - Header отображается над секциями
  - Даты продолжают загружаться
  - Таблицы работают как раньше

### 6. Созданные файлы ✅
- ✅ `e2e/step8-header-top-level.spec.ts` - E2E тесты для проверки header как top-level элемента

### 7. Итоговые результаты ✅
- ✅ Header корректно возвращается в `/api/layout` как отдельное поле
- ✅ Header не включен в массив `sections`
- ✅ Frontend использует `layout.header` для рендеринга
- ✅ Header отображается над секциями
- ✅ Все компоненты (таблицы, KPI) работают корректно
- ✅ Регрессия не сломана
