# –ü–ª–∞–Ω B.2.1 ‚Äî Financial Results: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ

> **–°–æ–∑–¥–∞–Ω**: 2026-01-23  
> **–°—Ç–∞—Ç—É—Å**: ‚è∏Ô∏è –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: B.2 (–ø—Ä–æ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –ø–æ —Å–ª–æ—è–º) ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `mart.fin_results`

---

## –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É Financial Results –Ω–∞ –¥–∞—à–±–æ—Ä–¥ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ–∫—Ü–∏—é "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã".  
**–§—Ä–æ–Ω—Ç –º–µ–Ω—è—Ç—å –ù–ï –Ω—É–∂–Ω–æ** ‚Äî –≤—Å—ë —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥–∏ –≤ –ë–î.

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ö–æ–Ω—Ñ–∏–≥ –∑–∞–ø—Ä–æ—Å–∞ –≤ `config.component_queries`

–°–æ–∑–¥–∞—Ç—å `fin_results_table` ‚Äî –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è SQL Builder.

```sql
INSERT INTO config.component_queries (query_id, title, config_json, wrap_json, is_active)
VALUES (
  'fin_results_table',
  '–î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
  '{
    "from": {
      "schema": "mart",
      "table": "fin_results"
    },
    "select": [
      { "type": "column", "field": "class" },
      { "type": "column", "field": "category" },
      { "type": "column", "field": "item" },
      { "type": "column", "field": "subitem" },
      {
        "type": "case_agg",
        "func": "sum",
        "when": { "field": "period_date", "op": "=", "value": ":p1" },
        "then": { "field": "value" },
        "else": null,
        "as": "value"
      },
      {
        "type": "case_agg",
        "func": "sum",
        "when": { "field": "period_date", "op": "=", "value": ":p2" },
        "then": { "field": "value" },
        "else": null,
        "as": "ppValue"
      },
      {
        "type": "case_agg",
        "func": "sum",
        "when": { "field": "period_date", "op": "=", "value": ":p3" },
        "then": { "field": "value" },
        "else": null,
        "as": "pyValue"
      }
    ],
    "where": {
      "op": "and",
      "items": [
        { "field": "period_date", "op": "in", "value": [":p1", ":p2", ":p3"] }
      ]
    },
    "groupBy": ["class", "category", "item", "subitem"],
    "orderBy": [
      { "field": "class", "direction": "asc" },
      { "field": "value", "direction": "desc", "nulls": "last" }
    ],
    "limit": 1000,
    "offset": 0,
    "params": {
      "p1": "2025-12-31",
      "p2": "2025-11-30",
      "p3": "2024-12-31"
    },
    "paramTypes": {
      "p1": "date",
      "p2": "date",
      "p3": "date"
    }
  }'::jsonb,
  FALSE,
  TRUE
) ON CONFLICT (query_id) DO UPDATE SET 
  config_json = EXCLUDED.config_json,
  updated_at = CURRENT_TIMESTAMP;
```

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ `config.components`

–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `fin_results_table`.

```sql
INSERT INTO config.components (
  id,
  component_type,
  title,
  label,
  data_source_key,
  is_active,
  created_by
) VALUES (
  'fin_results_table',
  'table',
  '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã',
  '–§–∏–Ω–†–µ–∑',
  'fin_results_table',  -- —Å—Å—ã–ª–∫–∞ –Ω–∞ query_id
  TRUE,
  'system'
) ON CONFLICT (id) DO UPDATE SET
  title = EXCLUDED.title,
  data_source_key = EXCLUDED.data_source_key,
  updated_at = CURRENT_TIMESTAMP;
```

### 3. –ü—Ä–∏–≤—è–∑–∫–∞ –∫ layout –≤ `config.layout_component_mapping`

–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ —Å–µ–∫—Ü–∏—é "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã" –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ.

**–®–∞–≥ 1: –ù–∞–π—Ç–∏ ID —Å–µ–∫—Ü–∏–∏**
```sql
-- –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã" –≤ layout
SELECT lcm.*, c.title 
FROM config.layout_component_mapping lcm
JOIN config.components c ON lcm.component_id = c.id
WHERE lcm.layout_id = 'main_dashboard'
  AND c.component_type = 'container'
  AND lcm.deleted_at IS NULL;
```

**–®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ —Å–µ–∫—Ü–∏—é**
```sql
-- –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º section_id = 'fin_results_section' (—É—Ç–æ—á–Ω–∏—Ç—å!)
INSERT INTO config.layout_component_mapping (
  id,
  layout_id,
  component_id,
  parent_component_id,
  display_order,
  is_visible,
  created_by
) 
SELECT 
  COALESCE(MAX(id), 0) + 1,
  'main_dashboard',
  'fin_results_table',
  'fin_results_section',  -- ID —Å–µ–∫—Ü–∏–∏ (—É—Ç–æ—á–Ω–∏—Ç—å!)
  10,  -- –ø–æ—Å–ª–µ –∫–∞—Ä—Ç–æ—á–µ–∫
  TRUE,
  'system'
FROM config.layout_component_mapping
WHERE NOT EXISTS (
  SELECT 1 FROM config.layout_component_mapping 
  WHERE layout_id = 'main_dashboard' 
    AND component_id = 'fin_results_table'
    AND deleted_at IS NULL
);
```

---

## –≠—Ç–∞–ø 1: Backend ‚Äî –ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ ‚úÖ

**–°—É–±–∞–≥–µ–Ω—Ç**: `backend-agent`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: B.2 (–¥–∞–Ω–Ω—ã–µ –≤ mart.fin_results)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ó–∞–¥–∞—á–∏:
- [x] 1.1 –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `backend/src/migrations/028_add_fin_results_to_dashboard.sql`
- [x] 1.2 –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ `fin_results_table` –≤ `config.component_queries`
- [x] 1.3 –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `fin_results_table` –≤ `config.components`
- [x] 1.4 –ù–∞–π—Ç–∏ ID —Å–µ–∫—Ü–∏–∏ "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã" –≤ –ë–î ‚Üí `section_financial_results`
- [x] 1.5 –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ `config.layout_component_mapping` (id=42)
- [x] 1.6 –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ psql (–ø—Ä—è–º—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º SQL)
- [x] 1.7 –û–±–Ω–æ–≤–∏—Ç—å `docs/context/database.md`

### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `backend/src/migrations/028_add_fin_results_to_dashboard.sql` (–Ω–æ–≤—ã–π)

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] API `/api/data?query_id=fin_results_table` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (10 –∑–∞–ø–∏—Å–µ–π)
- [ ] –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ –≤ —Å–µ–∫—Ü–∏–∏ "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"

### üìã –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ (—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ Executor):

```
–ó–∞–ø—É—Å—Ç–∏ backend-agent:
- –ü—Ä–æ—á–∏—Ç–∞–π docs/plans/current/B2.1_FIN_RESULTS_DASHBOARD.md
- –ü—Ä–æ—á–∏—Ç–∞–π docs/context/database.md
- –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏ SELECT —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ ID —Å–µ–∫—Ü–∏–∏ "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã":
  SELECT lcm.*, c.title FROM config.layout_component_mapping lcm
  JOIN config.components c ON lcm.component_id = c.id
  WHERE lcm.layout_id = 'main_dashboard' AND c.component_type = 'container';
- –°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é 028_add_fin_results_to_dashboard.sql
- –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é: cd backend && npm run migrate
- –ü—Ä–æ–≤–µ—Ä—å API: curl "http://localhost:3001/api/data?query_id=fin_results_table&parametrs=%7B%22p1%22%3A%222025-12-31%22%2C%22p2%22%3A%222025-11-30%22%2C%22p3%22%3A%222024-12-31%22%7D"
- –û–±–Ω–æ–≤–∏ docs/context/database.md
```

---

## –≠—Ç–∞–ø 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ üî¥

**–°—É–±–∞–≥–µ–Ω—Ç**: `qa-agent`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 1 ‚úÖ  
**–°—Ç–∞—Ç—É—Å**: üî¥ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

### –ó–∞–¥–∞—á–∏:
- [ ] 2.1 –û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] 2.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] 2.3 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ (class, category, value)
- [ ] 2.4 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É (–ø–æ class, –∑–∞—Ç–µ–º –ø–æ value desc)

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- [ ] –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–µ–∫—Ü–∏–∏ "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"
- [ ] –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (—Å–æ–≤–ø–∞–¥–∞—é—Ç —Å mart.fin_results)
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–¢–∞–±–ª–∏—Ü–∞ `mart.fin_results`:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| class | VARCHAR | –£—Ä–æ–≤–µ–Ω—å 1: –ß–ü–î, –ß–ö–î, –ß–û–î... |
| category | VARCHAR | –£—Ä–æ–≤–µ–Ω—å 2: –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π –¥–æ—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥ |
| item | VARCHAR | –£—Ä–æ–≤–µ–Ω—å 3: –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è |
| subitem | TEXT | –£—Ä–æ–≤–µ–Ω—å 4: —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ |
| value | NUMERIC | –°—É–º–º–∞ |
| period_date | DATE | –ü–µ—Ä–∏–æ–¥ |

---

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ UI

–¢–∞–±–ª–∏—Ü–∞ –≤ —Å–µ–∫—Ü–∏–∏ "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã":

| –°—Ç–∞—Ç—å—è | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ | MoM | YoY |
|--------|-----------|-------------|----------|-----|-----|
| 1) –ß–ü–î | –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π –¥–æ—Ö–æ–¥ | ... | ‚ÇΩXXX | +X% | +X% |
| 1) –ß–ü–î | –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ | ... | ‚ÇΩYYY | -X% | -X% |
| 2) –ß–ö–î | ... | ... | ‚ÇΩZZZ | ... | ... |

---

## –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –î–∞—Ç–∞ | –≠—Ç–∞–ø | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|------|-----------|-------------|
| 2026-01-30 | –≠—Ç–∞–ø 1 | ‚úÖ | –ú–∏–≥—Ä–∞—Ü–∏—è 028 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ layout (id=42), API —Ä–∞–±–æ—Ç–∞–µ—Ç |
