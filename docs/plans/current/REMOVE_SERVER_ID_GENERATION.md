# –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –£–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é transformTableData

> **–°–æ–∑–¥–∞–Ω**: 2026-01-23  
> **–°—Ç–∞—Ç—É—Å**: üî¥ –í —Ä–∞–±–æ—Ç–µ (–≠—Ç–∞–ø 1 –∑–∞–≤–µ—Ä—à—ë–Ω)  
> **Roadmap**: –¢–µ—Ö–¥–æ–ª–≥ / –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `transformTableData` –≤ `dataRoutes.ts` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–∞—Ä–¥–∫–æ–¥:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `id` –∏–∑ `[class, section, item, sub_item]` ‚Äî –ª–æ–º–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—è–º–∏ (fin_results)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `sortOrder` —á–µ—Ä–µ–∑ `getSortOrder` ‚Äî —Ç–æ–∂–µ —Ö–∞—Ä–¥–∫–æ–¥
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ string ‚Üí number ‚Äî —É–∂–µ –¥–µ–ª–∞–µ—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é `transformTableData`. –§—Ä–æ–Ω—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —É–∂–µ —É–º–µ–µ—Ç:
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ id (`leaf-N`)
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —Ç–∏–ø—ã (`Number()`)

**–§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:**
- `backend/src/routes/dataRoutes.ts` ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω–∞—è transformTableData (—É–¥–∞–ª–∏—Ç—å)
- `src/pages/DynamicDashboard.tsx` ‚Äî —Ñ—Ä–æ–Ω—Ç–æ–≤–∞—è transformTableData
- `docs/context/backend.md`

---

## –≠—Ç–∞–ø 1: Backend ‚Äî –£–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é transformTableData ‚úÖ

**–°—É–±–∞–≥–µ–Ω—Ç**: `backend-agent`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ù–µ—Ç  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ (2026-01-30)

### –ó–∞–¥–∞—á–∏:

- [ ] **1.1** –£–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `transformTableData` –∏–∑ `backend/src/routes/dataRoutes.ts`
- [ ] **1.2** –£–±—Ä–∞—Ç—å –≤—ã–∑–æ–≤—ã `transformTableData` (–∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—Ä—è–º—É—é –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö)
- [ ] **1.3** –£–¥–∞–ª–∏—Ç—å –∏–º–ø–æ—Ä—Ç `getSortOrder` –µ—Å–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- [ ] **1.4** –û–±–Ω–æ–≤–∏—Ç—å `docs/context/backend.md`

### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:

- `backend/src/routes/dataRoutes.ts`

### –ß—Ç–æ —É–¥–∞–ª–∏—Ç—å:

```typescript
// –£–î–ê–õ–ò–¢–¨ –≤—Å—é —Ñ—É–Ω–∫—Ü–∏—é:
function transformTableData(rows: any[]): any[] {
  return rows.map(row => {
    // –ï—Å–ª–∏ id —É–∂–µ –µ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ —Ñ–æ—Ä–º–∏—Ä—É–µ–º
    if (!row.id) {
      const idParts = [
        row.class,
        row.section,
        row.item,
        row.sub_item
      ].filter(Boolean);
      row.id = idParts.join('-') || 'unknown';
    }
    
    // –ï—Å–ª–∏ sortOrder –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
    if (row.sortOrder === undefined || row.sortOrder === null) {
      row.sortOrder = getSortOrder(String(row.id));
    }
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ —á–∏—Å–ª–∞...
    ...
    
    return row;
  });
}

// –£–î–ê–õ–ò–¢–¨ –∏–º–ø–æ—Ä—Ç:
import { getSortOrder } from "../services/mart/base/rowNameMapper.js";
```

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:

```typescript
// –ë–´–õ–û:
const transformedData = transformTableData(data);
return res.json({ componentId: component_Id, type: "table", rows: transformedData });

// –°–¢–ê–õ–û:
return res.json({ componentId: component_Id, type: "table", rows: data });
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:

- [x] `npm run build` –±–µ–∑ –æ—à–∏–±–æ–∫ –≤ backend (pre-existing –æ—à–∏–±–∫–∏ —Ç–æ–ª—å–∫–æ –≤ scripts/)
- [x] –§—É–Ω–∫—Ü–∏—è `transformTableData` —É–¥–∞–ª–µ–Ω–∞
- [x] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ SQL (–±–µ–∑ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏)
- [x] –ò–º–ø–æ—Ä—Ç `getSortOrder` —É–¥–∞–ª—ë–Ω
- [x] `docs/context/backend.md` –æ–±–Ω–æ–≤–ª—ë–Ω

### üìã –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Executor:

```javascript
Task(
  subagent_type: "backend-agent",
  description: "Delete server transformTableData",
  prompt: `
    –ü—Ä–æ—á–∏—Ç–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: docs/context/backend.md
    –ü—Ä–æ—á–∏—Ç–∞–π –ø–ª–∞–Ω: docs/plans/current/REMOVE_SERVER_ID_GENERATION.md, —Ä–∞–∑–¥–µ–ª "–≠—Ç–∞–ø 1"
    
    –í backend/src/routes/dataRoutes.ts:
    1. –£–¥–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é transformTableData –ø–æ–ª–Ω–æ—Å—Ç—å—é
    2. –ù–∞–π–¥–∏ –≤—Å–µ –º–µ—Å—Ç–∞ –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è transformTableData –∏ –∑–∞–º–µ–Ω–∏ –Ω–∞ –ø—Ä—è–º—É—é –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö
    3. –£–¥–∞–ª–∏ –∏–º–ø–æ—Ä—Ç getSortOrder –∏–∑ rowNameMapper.js –µ—Å–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    
    –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
    - –ü—Ä–æ–≤–µ—Ä—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é: cd backend && npm run build
    - –û–±–Ω–æ–≤–∏ docs/context/backend.md (—É–±–µ—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π transformTableData)
    - –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–∞ –≤ –ø–ª–∞–Ω–µ –Ω–∞ ‚úÖ
  `
)
```

---

## –≠—Ç–∞–ø 2: Frontend ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é id ‚è∏Ô∏è

**–°—É–±–∞–≥–µ–Ω—Ç**: `frontend-agent`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 1 ‚úÖ  
**–°—Ç–∞—Ç—É—Å**: ‚è∏Ô∏è –û–∂–∏–¥–∞–µ—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **2.1** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–æ–≤–∞—è `transformTableData` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç id –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
- [ ] **2.2** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `id: String(rowData.id || \`leaf-${orderCounter}\`)` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] **2.3** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ assets_table –∏ fin_results_table –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] **2.4** –û–±–Ω–æ–≤–∏—Ç—å `docs/context/frontend.md` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

### –§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

- `src/pages/DynamicDashboard.tsx` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è transformTableData

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:

- [ ] assets_table –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ id)
- [ ] fin_results_table –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Å id –∏–∑ –ë–î)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ "Maximum call stack size exceeded"
- [ ] –ì—Ä—É–ø–ø—ã —Å–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è

### üìã –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Executor:

```javascript
Task(
  subagent_type: "frontend-agent",
  description: "Verify frontend id generation",
  prompt: `
    –ü—Ä–æ—á–∏—Ç–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: docs/context/frontend.md
    –ü—Ä–æ—á–∏—Ç–∞–π –ø–ª–∞–Ω: docs/plans/current/REMOVE_SERVER_ID_GENERATION.md, —Ä–∞–∑–¥–µ–ª "–≠—Ç–∞–ø 2"
    
    –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–æ–≤–∞—è transformTableData –≤ src/pages/DynamicDashboard.tsx:
    1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç id: String(rowData.id || \`leaf-\${orderCounter}\`)
    2. –í—Å–µ leaf-—Å—Ç—Ä–æ–∫–∏ –∏–º–µ—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ id
    
    –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
    - –û—Ç–∫—Ä–æ–π http://localhost:5173
    - –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã assets –∏ fin_results –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
    - –ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø
    - –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
    
    –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
    - –û–±–Ω–æ–≤–∏ docs/context/frontend.md –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    - –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–∞ –≤ –ø–ª–∞–Ω–µ –Ω–∞ ‚úÖ
  `
)
```

---

## –≠—Ç–∞–ø 3: QA ‚Äî E2E —Ç–µ—Å—Ç—ã ‚è∏Ô∏è

**–°—É–±–∞–≥–µ–Ω—Ç**: `qa-agent`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø—ã 1, 2 ‚úÖ  
**–°—Ç–∞—Ç—É—Å**: ‚è∏Ô∏è –û–∂–∏–¥–∞–µ—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **3.1** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ E2E —Ç–µ—Å—Ç—ã
- [ ] **3.2** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] **3.3** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π

### üìã –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Executor:

```javascript
Task(
  subagent_type: "qa-agent",
  description: "E2E regression tests",
  prompt: `
    –ü—Ä–æ—á–∏—Ç–∞–π –ø–ª–∞–Ω: docs/plans/current/REMOVE_SERVER_ID_GENERATION.md, —Ä–∞–∑–¥–µ–ª "–≠—Ç–∞–ø 3"
    
    –ó–∞–ø—É—Å—Ç–∏ —Ä–µ–≥—Ä–µ—Å—Å E2E —Ç–µ—Å—Ç–æ–≤:
    npm run test:e2e -- --reporter=list
    
    –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ:
    - –¢–∞–±–ª–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
    - –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
    - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç
    
    –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–∞ –≤ –ø–ª–∞–Ω–µ –Ω–∞ ‚úÖ
  `
)
```

---

## –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤:

```bash
# Backend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
cd backend && npm run build

# Frontend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
npm run build

# E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
npm run test:e2e -- --reporter=list

# –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
# - assets_table —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ id
# - fin_results_table —Ä–∞–±–æ—Ç–∞–µ—Ç —Å id –∏–∑ –ë–î
# - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—é—Ç
```

---

## –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –î–∞—Ç–∞ | –≠—Ç–∞–ø | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|------|-----------|-------------|
| 2026-01-30 | –≠—Ç–∞–ø 1 | ‚úÖ | –£–¥–∞–ª–µ–Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è transformTableData –∏ –∏–º–ø–æ—Ä—Ç getSortOrder. API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é. |
