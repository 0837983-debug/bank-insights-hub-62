# –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: FinancialTable –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞ calculated –ø–æ–ª–µ–π

> **–°–æ–∑–¥–∞–Ω**: 2026-02-04  
> **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
> **Roadmap**: H.5 ‚Äî –¢–∏–ø–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π + Calculated fields

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–í `FinancialTable` —Ö–∞—Ä–¥–∫–æ–¥—è—Ç—Å—è –ø–æ–ª—è `ppChange/ytdChange` –∏ –∏—Ö —Ñ–æ—Ä–º–∞—Ç—ã. –í layout –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥—Ä—É–≥–∏–µ id (–Ω–∞–ø—Ä–∏–º–µ—Ä, `p2Change`, `p3Change`), –ø–æ—ç—Ç–æ–º—É calculated –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å calculated sub_columns –ø–æ layout.  
–í–∞–∂–Ω–æ: –∞–≥—Ä–µ–≥–∞—Ç—ã –∏ calculated –∑–Ω–∞—á–µ–Ω–∏—è —Å—á–∏—Ç–∞—é—Ç—Å—è –≤ `transformTableData` ‚Äî `FinancialTable` –¥–æ–ª–∂–µ–Ω —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –ø–æ–ª—è –∏–∑ `row`.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:**
- `docs/context/frontend.md`
- `src/pages/DynamicDashboard.tsx` (transformTableData)
- `src/components/FinancialTable.tsx`

---

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ: –≤–∞—Ä–∏–∞–Ω—Ç A)

**–í–∞—Ä–∏–∞–Ω—Ç A (–≤—ã–±—Ä–∞–Ω):**  
–î–ª—è –∫–∞–∂–¥–æ–π —á–∏—Å–ª–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å calculated sub_columns –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏:  
1) —Å–æ–±–∏—Ä–∞—Ç—å `sub_columns` —Å `fieldType === 'calculated'`  
2) –±—Ä–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `row[subColumn.id]` (–æ–Ω–æ —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –≤ `transformTableData`)  
3) —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `formatValue` –ø–æ `subColumn.format`  
4) –ø–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞ = –ø–æ—Ä—è–¥–æ–∫ sub_columns –≤ layout  
5) –ù–ò–ö–ê–ö–û–ì–û —Ö–∞—Ä–¥–∫–æ–¥–∞ id

**–í–∞—Ä–∏–∞–Ω—Ç B (–Ω–µ –≤—ã–±—Ä–∞–Ω):**  
–°–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã/–∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è calculated –ø–æ–ª–µ–π.

---

## ‚õî –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)

### –ó–ê–ü–†–ï–©–ï–ù–û:
- **Backward compatibility –∫–æ—Å—Ç—ã–ª–∏**
- **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã**
- **–•–∞—Ä–¥–∫–æ–¥ –∏–º—ë–Ω –ø–æ–ª–µ–π**
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–æ–≤**

### –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
- –û–¥–∏–Ω –ø—É—Ç—å –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ layout + transformTableData)
- –£–¥–∞–ª—è—Ç—å deprecated –ª–æ–≥–∏–∫—É
- –ß–∏—Å—Ç—ã–π –∫–æ–¥ –±–µ–∑ ¬´–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö¬ª –±–ª–æ–∫–æ–≤

---

## –≠—Ç–∞–ø 1: DB/Config (–ø—Ä–æ–≤–µ—Ä–∫–∞) ‚úÖ

**–°—É–±–∞–≥–µ–Ω—Ç**: `db-agent`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ù–µ—Ç  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ó–∞–¥–∞—á–∏:
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `config.component_fields` –¥–ª—è table –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
  - `sub_columns` –∏–º–µ—é—Ç `fieldType = 'calculated'`
  - `calculation_config` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –∏–∑ getData (`p2Value/p3Value` –∏–ª–∏ –¥—Ä—É–≥–∏–µ)
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `config.component_queries` –¥–ª—è —Ç–∞–±–ª–∏—Ü, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ–ª—è, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `calculation_config`
- [x] –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å SQL UPDATE (–±–µ–∑ DDL) –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- [x] –ö–æ–Ω—Ñ–∏–≥ layout –∏ getData —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –ø–æ –∏–º–µ–Ω–∞–º –ø–æ–ª–µ–π
- [x] –ù–µ—Ç calculated –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (2026-02-04):

**assets_table** ‚Äî ‚úÖ –û–ö
- getData –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `value`, `p2Value`, `p3Value`
- calculated —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞: `value`, `p2Value`, `p3Value`

**fin_results_table** ‚Äî ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- getData –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `value`, `ppValue`, `pyValue`
- –ë—ã–ª–æ: calculated —Å—Å—ã–ª–∞–ª–∏—Å—å –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `p2Value`, `p3Value`
- –°—Ç–∞–ª–æ: calculated —Ç–µ–ø–µ—Ä—å —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ `ppValue`, `pyValue`

SQL UPDATE –ø—Ä–∏–º–µ–Ω—ë–Ω:
```sql
UPDATE config.component_fields SET calculation_config = 
  '{"base": "ppValue", "type": "percent_change", "current": "value"}' WHERE field_id = 'p2Change';
UPDATE config.component_fields SET calculation_config = 
  '{"base": "pyValue", "type": "percent_change", "current": "value"}' WHERE field_id = 'p3Change';
UPDATE config.component_fields SET calculation_config = 
  '{"type": "diff", "minuend": "value", "subtrahend": "ppValue"}' WHERE field_id = 'p2ChangeAbsolute';
UPDATE config.component_fields SET calculation_config = 
  '{"type": "diff", "minuend": "value", "subtrahend": "pyValue"}' WHERE field_id = 'p3ChangeAbsolute';
```

### üìã –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Executor (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Task tool!):

```javascript
Task(
  subagent_type: "db-agent",
  description: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ calculated –ø–æ–ª–µ–π —Ç–∞–±–ª–∏—Ü",
  prompt: `
    –ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú –†–ê–ë–û–¢–´:
    1. –ü—Ä–æ—á–∏—Ç–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: docs/context/database.md
    2. –ü—Ä–æ—á–∏—Ç–∞–π –ø–ª–∞–Ω: docs/plans/current/FINANCIAL_TABLE_DYNAMIC_CALCULATED_FIELDS.md

    –ü—Ä–æ–≤–µ—Ä—å:
    - config.component_fields (calculated sub_columns)
    - config.component_queries (–∫–∞–∫–∏–µ –ø–æ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç getData)

    –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ SQL UPDATE (–±–µ–∑ DDL).
    –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–∞ –≤ –ø–ª–∞–Ω–µ –Ω–∞ ‚úÖ.
  `
)
```

---

## –≠—Ç–∞–ø 2: Frontend ‚úÖ

**–°—É–±–∞–≥–µ–Ω—Ç**: `frontend-agent`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 1 ‚úÖ  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ó–∞–¥–∞—á–∏:
- [x] –£–¥–∞–ª–∏—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ `ppChange/ytdChange` –≤ `FinancialTable`
- [x] –î–ª—è –∫–∞–∂–¥–æ–π —á–∏—Å–ª–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏:
  - —Å–æ–±—Ä–∞—Ç—å `sub_columns` —Å `fieldType === 'calculated'`
  - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ sub_column –≤–∑—è—Ç—å `row[subColumn.id]`
  - –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ `subColumn.format`
  - —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å **—Å–ø–∏—Å–∫–æ–º** –ø–æ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
- [x] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `FinancialTable` **–Ω–µ —Å—á–∏—Ç–∞–µ—Ç** –∑–Ω–∞—á–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∏–∑ `transformTableData`)
- [x] –û–±–Ω–æ–≤–∏—Ç—å `docs/context/frontend.md`

### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `src/components/FinancialTable.tsx`

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- [x] –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ `ppChange/ytdChange`
- [x] Calculated –ø–æ–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ layout (`p2Change/p3Change` –∏ —Ç.–ø.)
- [x] `npm run build` –±–µ–∑ –æ—à–∏–±–æ–∫

### üìã –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Executor (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Task tool!):

```javascript
Task(
  subagent_type: "frontend-agent",
  description: "FinancialTable: calculated –ø–æ–ª—è –∏–∑ layout –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞",
  prompt: `
    –ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú –†–ê–ë–û–¢–´:
    1. –ü—Ä–æ—á–∏—Ç–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: docs/context/frontend.md
    2. –ü—Ä–æ—á–∏—Ç–∞–π –ø–ª–∞–Ω: docs/plans/current/FINANCIAL_TABLE_DYNAMIC_CALCULATED_FIELDS.md
    3. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π –¢–û–õ–¨–ö–û —Ñ–∞–π–ª—ã —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –ø–ª–∞–Ω–µ

    ‚õî –ó–ê–ü–†–ï–©–ï–ù–û:
    - –•–∞—Ä–¥–∫–æ–¥–∏—Ç—å –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π
    - –û—Å—Ç–∞–≤–ª—è—Ç—å fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É
    - –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—á—ë—Ç—ã

    –í—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞—á–∏ –≠—Ç–∞–ø–∞ 2.

    –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
    - –ü—Ä–æ–≤–µ—Ä—å —Å–±–æ—Ä–∫—É: npm run build
    - –û–±–Ω–æ–≤–∏ docs/context/frontend.md
    - –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–∞ –≤ –ø–ª–∞–Ω–µ –Ω–∞ ‚úÖ
  `
)
```

---

## –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# Frontend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
npm run build
```

---

## –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –î–∞—Ç–∞ | –≠—Ç–∞–ø | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|------|-----------|-------------|
| 2026-02-04 | –≠—Ç–∞–ø 1 | ‚úÖ | DB-agent: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω calculation_config –¥–ª—è fin_results_table (ppValue/pyValue –≤–º–µ—Å—Ç–æ p2Value/p3Value) |
| 2026-02-04 | –≠—Ç–∞–ø 2 | ‚úÖ | Frontend-agent: –£–¥–∞–ª—ë–Ω —Ö–∞—Ä–¥–∫–æ–¥ ppChange/ytdChange, calculated –ø–æ–ª—è —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ layout sub_columns |
