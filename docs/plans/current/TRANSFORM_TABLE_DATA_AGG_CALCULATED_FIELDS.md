# –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: transformTableData ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ calculated –ø–æ–ª—è –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ç–∞—Ö

> **–°–æ–∑–¥–∞–Ω**: 2026-02-04  
> **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
> **Roadmap**: H.5 ‚Äî –¢–∏–ø–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π + Calculated fields

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–°–µ–π—á–∞—Å `transformTableData` —Å—á–∏—Ç–∞–µ—Ç calculated –ø–æ–ª—è –¥–ª—è –≥—Ä—É–ø–ø (aggregate rows) —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ `measureFields`. –ï—Å–ª–∏ `calculationConfig` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `p2Value/p3Value` –∏–ª–∏ –¥—Ä—É–≥–∏–µ –Ω–µ‚Äëmeasure –ø–æ–ª—è, –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ–ª—É—á–∞—é—Ç 0.  
–ù—É–∂–Ω–æ: –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å **–≤—Å–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ calculationConfig**, –∞ –∑–∞—Ç–µ–º –≤—ã—á–∏—Å–ª—è—Ç—å calculated –ø–æ–ª—è –Ω–∞ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö.

**–§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:**
- `docs/context/frontend.md`
- `src/pages/DynamicDashboard.tsx` (transformTableData)
- `src/lib/calculations.ts` (executeCalculation)

---

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ: –≤–∞—Ä–∏–∞–Ω—Ç A)

**–í–∞—Ä–∏–∞–Ω—Ç A (–≤—ã–±—Ä–∞–Ω):**  
1) –°–æ–±—Ä–∞—Ç—å —Å–ø–∏—Å–æ–∫ **dependency‚Äë–ø–æ–ª–µ–π** –∏–∑ `calculationConfig` (`current/base`, `minuend/subtrahend`, `numerator/denominator`)  
2) `aggregationFields = measureFields ‚à™ dependencyFields`  
3) –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å **–≤—Å–µ aggregationFields**  
4) –°—á–∏—Ç–∞—Ç—å calculated –ø–æ–ª—è –¥–ª—è –≥—Ä—É–ø–ø –Ω–∞ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö  
5) `transformTableData` –Ω–µ –≤—ã–≤–æ–¥–∏—Ç dependencyFields –∫–∞–∫ –∫–æ–ª–æ–Ω–∫–∏ (—Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π)

---

## ‚õî –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)

### –ó–ê–ü–†–ï–©–ï–ù–û:
- **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã**
- **–•–∞—Ä–¥–∫–æ–¥ –∏–º—ë–Ω –ø–æ–ª–µ–π**
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–æ–≤**

### –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
- –û–¥–∏–Ω –ø—É—Ç—å –¥–∞–Ω–Ω—ã—Ö (layout + transformTableData)
- –ß–∏—Å—Ç—ã–π –∫–æ–¥ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤

---

## –≠—Ç–∞–ø 1: Frontend ‚úÖ

**–°—É–±–∞–≥–µ–Ω—Ç**: `frontend-agent`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ù–µ—Ç  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ó–∞–¥–∞—á–∏:
- [x] –í `transformTableData` —Å–æ–±—Ä–∞—Ç—å `dependencyFields` –∏–∑ `calculationConfig`:
  - `current`, `base`, `minuend`, `subtrahend`, `numerator`, `denominator`
- [x] –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å `aggregationFields = measureFields ‚à™ dependencyFields`
- [x] –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å **aggregationFields** –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
- [x] –ü—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ calculated –ø–æ–ª–µ–π –¥–ª—è **group rows** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- [x] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `transformTableData` –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–º—ë–Ω (`p2Value`, `p3Value`)
- [x] –û–±–Ω–æ–≤–∏—Ç—å `docs/context/frontend.md`

### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `src/pages/DynamicDashboard.tsx`

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- [x] Calculated –ø–æ–ª—è –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ ‚â† 0, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
- [x] –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ –∏–º—ë–Ω –ø–æ–ª–µ–π
- [x] `npm run build` –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] `npm run test:frontend` –±–µ–∑ –æ—à–∏–±–æ–∫ (60 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏)

### üìã –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Executor (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Task tool!):

```javascript
Task(
  subagent_type: "frontend-agent",
  description: "transformTableData: aggregates use calculation dependencies",
  prompt: `
    –ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú –†–ê–ë–û–¢–´:
    1. –ü—Ä–æ—á–∏—Ç–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: docs/context/frontend.md
    2. –ü—Ä–æ—á–∏—Ç–∞–π –ø–ª–∞–Ω: docs/plans/current/TRANSFORM_TABLE_DATA_AGG_CALCULATED_FIELDS.md
    3. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π –¢–û–õ–¨–ö–û —Ñ–∞–π–ª—ã —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –ø–ª–∞–Ω–µ

    ‚õî –ó–ê–ü–†–ï–©–ï–ù–û:
    - –•–∞—Ä–¥–∫–æ–¥–∏—Ç—å –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π
    - –î–æ–±–∞–≤–ª—è—Ç—å fallback

    –í—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞—á–∏ –≠—Ç–∞–ø–∞ 1.

    –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
    - npm run build
    - npm run test:frontend
    - –û–±–Ω–æ–≤–∏ docs/context/frontend.md
    - –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–∞ –≤ –ø–ª–∞–Ω–µ –Ω–∞ ‚úÖ
  `
)
```

---

## –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
npm run build
npm run test:frontend
```

---

## –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –î–∞—Ç–∞ | –≠—Ç–∞–ø | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|------|-----------|-------------|
| 2026-02-05 | –≠—Ç–∞–ø 1 | ‚úÖ | transformTableData: dependencyFields —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏–∑ calculationConfig, aggregationFields = measureFields ‚à™ dependencyFields, –≥—Ä—É–ø–ø—ã –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç –≤—Å–µ aggregationFields, calculated –ø–æ–ª—è –Ω–∞ –≥—Ä—É–ø–ø–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç aggregatedValues |
