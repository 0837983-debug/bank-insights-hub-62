---
title: Архитектура базы данных
description: Структура и организация базы данных
related:
  - /architecture/overview
  - /database/schemas
  - /database/data-marts
---

# Архитектура базы данных

База данных использует PostgreSQL с разделением на несколько схем для организации данных.

## Схемы базы данных

### config

Метаданные и конфигурация системы.

**Таблицы:**
- `layouts` - конфигурации layout
- `components` - библиотека компонентов
- `layout_component_mapping` - связи layout-компонент
- `component_fields` - поля компонентов
- `formats` - форматы отображения
- `component_queries` - конфиги SQL запросов для SQL Builder

**Назначение:** Управление структурой UI и метаданными.

### mart

Data Mart - агрегированные данные для быстрого доступа.

**Таблицы:**
- `kpi_metrics` - KPI метрики по периодам
- `financial_results` - финансовые результаты
- `balance` - баланс

**Назначение:** Оптимизированные данные для API.

### Другие схемы

- `stg` - staging (временное хранилище для загрузки файлов)
- `ods` - Operational Data Store (основное хранилище загруженных данных)
- `ing` - ingestion (метаданные загрузок файлов)
- `dict` - справочники и маппинги
- `log` - логирование (детальные логи операций)

## Принципы организации

### 1. Schema Separation

Разделение по схемам для:
- Изоляции данных
- Управления правами доступа
- Логической организации

### 2. Data Mart Pattern

Агрегированные данные в отдельной схеме:
- Быстрый доступ
- Оптимизированные запросы
- Разделение чтения и записи

### 3. Configuration-Driven

Метаданные в config схеме:
- Динамическая структура UI
- Изменения без передеплоя
- Гибкость настройки

## Связи между схемами

### config ↔ mart

Компоненты из config ссылаются на данные в mart:
- `config.components.data_source_key` → `config.component_queries.query_id` → SQL Builder → `mart.*`
- `config.components.id` → `mart.kpi_metrics.component_id` (для карточек)
- `config.components.id` → `mart.balance.table_component_id` (для таблиц)


## Индексы

Индексы созданы для оптимизации:
- По внешним ключам
- По часто используемым полям для фильтрации
- По полям для сортировки

## Миграции

Структура БД управляется через SQL миграции:
- Нумерованные файлы
- Последовательное выполнение
- Версионирование изменений

Подробнее в разделе [Миграции](/database/migrations).

## См. также

- [Схемы БД](/database/schemas) - детальное описание схем
- [Data Marts](/database/data-marts) - структура Data Mart
- [Миграции](/database/migrations) - работа с миграциями
